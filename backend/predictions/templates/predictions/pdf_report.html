<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>DiaGuard - Prediction Report</title>
    <style>
        /* Base reset */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            color: #1f2937;
            padding: 40px;
            line-height: 1.6;
        }

        h1 {
            font-size: 24px;
            font-weight: bold;
            color: #2563eb;
            margin-bottom: 20px;
        }

        h2 {
            font-size: 18px;
            font-weight: bold;
            margin-top: 30px;
            margin-bottom: 10px;
            border-bottom: 1px solid #e5e7eb;
            padding-bottom: 4px;
        }

        .summary p {
            font-size: 14px;
            margin-bottom: 6px;
        }

        .inputs table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        .inputs th,
        .inputs td {
            text-align: left;
            padding: 6px 8px;
            border-bottom: 1px solid #e5e7eb;
            font-size: 13px;
        }

        .recs ul {
            list-style-type: disc;
            margin-left: 20px;
            margin-top: 8px;
        }

        .recs li {
            font-size: 14px;
            margin-bottom: 6px;
        }

        .disclaimer {
            font-size: 11px;
            color: #6b7280;
            margin-top: 30px;
            font-style: italic;
        }

        footer {
            margin-top: 40px;
            text-align: center;
            font-size: 11px;
            color: #9ca3af;
        }
    </style>
</head>

<body>
    <!-- Title -->
    <h1>DiaGuard – Prediction Report</h1>

    <!-- Summary -->
    <div class="summary">
        <p><strong>Date:</strong> {{ pred.created_at|date:"Y-m-d H:i" }}</p>
        <p><strong>Risk level:</strong> {{ pred.risk_level|title }}</p>
        <p><strong>Model confidence:</strong> {% widthratio pred.confidence_score 1 100 %}%</p>
    </div>

    <!-- Inputs section -->
    <h2>Inputs Provided</h2>
    <div class="inputs">
        <table>
            <tr>
                <th>Age</th>
                <td>{{ pred.health_input.age }}</td>
            </tr>
            <tr>
                <th>BMI</th>
                <td>{{ pred.health_input.bmi }}</td>
            </tr>
            <tr>
                <th>HbA1c (%)</th>
                <td>{{ pred.health_input.hba1c }}</td>
            </tr>
            <tr>
                <th>Blood Glucose (mg/dL)</th>
                <td>{{ pred.health_input.blood_glucose }}</td>
            </tr>
            <tr>
                <th>Hypertension</th>
                <td>{{ pred.health_input.hypertension|yesno:"Yes,No" }}</td>
            </tr>
            <tr>
                <th>Heart Disease</th>
                <td>{{ pred.health_input.heart_disease|yesno:"Yes,No" }}</td>
            </tr>
            <tr>
                <th>Smoking History</th>
                <td>{{ pred.health_input.smoking_history|title }}</td>
            </tr>
        </table>
    </div>

    <!-- SHAP image -->
    <h2>Top Contributing Features</h2>
    <img src="data:image/png;base64,{{ shap_img_b64 }}"
        style="display:block; width:100%; max-width:600px; margin-top:10px;">

    <!-- Recommendations -->
    {% if pred.recommendations.all %}
    <h2>Recommendations</h2>
    <div class="recs">
        <ul>
            {% for rec in pred.recommendations.all %}
            <li>{{ rec.content }}</li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}

    <!-- Disclaimer -->
    <p class="disclaimer">
        This report is provided for informational purposes only and does not constitute medical advice.
        It should not replace consultation with qualified healthcare professionals.
    </p>

    <!-- Footer -->
    <footer>
        Generated by DiaGuard – {{ pred.created_at|date:"Y" }}
    </footer>
</body>

</html>